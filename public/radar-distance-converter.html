<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雷达值提取工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }
        .input-area {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%;
            height: 80px;
            margin-bottom: 8px;
            font-family: monospace;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-size: 15px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
            height: 100%;
        }
        .radar-values {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        .radar-value {
            padding: 6px;
            background-color: #e9e9e9;
            border-radius: 4px;
            text-align: center;
            font-family: monospace;
            font-size: 14px;
            transition: transform 0.2s;
        }
        .radar-value:hover {
            transform: scale(1.05);
        }
        .radar-group {
            margin-bottom: 12px;
            padding: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
        }
        .radar-group h4 {
            margin: 0 0 8px 0;
            font-size: 15px;
        }
        .error {
            color: red;
            margin-top: 8px;
            font-weight: bold;
            font-size: 14px;
        }
        .format-examples {
            margin-top: 8px;
            font-size: 0.85em;
            color: #666;
            background-color: #fff;
            padding: 8px;
            border-radius: 4px;
        }

        /* 主要内容区域布局 */
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .results-section {
            flex: 1;
            min-width: 300px;
        }
        
        .layout-section {
            flex: 1;
            min-width: 300px;
        }

        /* 传感器布局样式 */
        .sensor-layout {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            height: 100%;
            box-sizing: border-box;
        }
        .sensor-layout h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        .layout-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 400px;
            margin: 10px auto;
            border: 2px dashed #999;
            border-radius: 4px;
            background-color: #fff;
        }
        .sensor {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
            transform: translate(-50%, -50%);
            transition: all 0.3s;
            cursor: pointer;
        }
        .sensor:hover {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        .sensor-label {
            position: absolute;
            font-size: 10px;
            font-weight: bold;
            white-space: nowrap;
        }
        .front-label, .rear-label {
            position: absolute;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            transform: translateX(-50%);
        }
        .front-label {
            top: -12px;
            left: 50%;
            background-color: #4CAF50;
            color: white;
        }
        .rear-label {
            bottom: -12px;
            left: 50%;
            background-color: #2196F3;
            color: white;
        }
        .sensor.front {
            background-color: #f44336;
        }
        .sensor.rear {
            background-color: #4CAF50;
        }
        .sensor.side {
            background-color: #333;
        }
        .legend {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 14px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }
        
        /* 加载动画样式 */
        .loading {
            display: none;
            margin-top: 10px;
            text-align: center;
        }
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(76, 175, 80, 0.3);
            border-radius: 50%;
            border-top-color: #4CAF50;
            animation: spin 1s ease-in-out infinite;
            display: inline-block;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 十进制到十六进制转换信息样式 */
        .decimal-to-hex {
            color: #666;
            font-size: 0.9em;
            margin: 5px 0;
            padding: 5px;
            background-color: #f0f8ff;
            border-radius: 3px;
        }
        
        /* 传感器数值样式 - 修改为单行显示 */
        .sensor-value {
            font-size: 10px !important;
            white-space: nowrap; /* 防止换行 */
        }
        
        /* 返回按钮样式 */
        .back-button-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .back-button {
            background-color: #6c757d;
            padding: 8px 16px;
            font-size: 14px;
        }
        .back-button:hover {
            background-color: #5a6268;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .layout-container {
                height: 350px;
            }
            
            .sensor-label {
                font-size: 9px;
            }
        }
    </style>
</head>
<body>
    <div class="back-button-container">
        <button class="back-button" onclick="window.location.href='/'">← 返回主页</button>
    </div>
    
    <h1 style="margin: 0 0 15px 0; font-size: 22px;">雷达值提取工具（小端序）</h1>
    
    <div class="input-area">
        <h3 style="margin: 0 0 8px 0; font-size: 16px;">输入雷达值，4个32位数值（过滤Log，radar_data或者是eventId:30003 使用后面的值）：</h3>
        <textarea id="radarInput" placeholder="例如：0xf3f2f1f0 f7f6f5f4 fbfaf9f8 fffefdfc">0xf3f2f1f0 f7f6f5f4 fbfaf9f8 fffefdfc</textarea>
        <div class="format-examples">支持格式：<br>1. 0xf3f2f1f0 f7f6f5f4 fbfaf9f8 fffefdfc<br>2. 0xf3f2f1f0 0xf7f6f5f4 0xfbfaf9f8 0xfffefdfc<br>3. 4089446896 4160872820 4232298744 4294901244（十进制）</div>
        <button onclick="extractRadarValues()">提取雷达值</button>
        <!-- 加载动画 -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <span style="margin-left: 8px; color: #666;">正在提取雷达值...</span>
        </div>
        <div id="error" class="error"></div>
    </div>
    
    <div class="main-content">
        <div class="results-section">
            <div class="result" id="result" style="display: none;">
                <h3 style="margin: 0 0 10px 0; font-size: 16px;">提取结果（小端序）：</h3>
                <div id="conversionInfo" style="margin-bottom: 15px;"></div>
                <div id="radarGroups"></div>
            </div>
        </div>

        <!-- 传感器布局图 -->
        <div class="layout-section">
            <div class="sensor-layout">
                <h2>Grid Sensor Layout</h2>
                <div class="layout-container">
                    <div class="front-label">Front</div>
                    <div class="rear-label">Rear</div>
                    
                    <!-- 前向传感器（左→右: 3-2-1-0） -->
                    <div class="sensor front" data-radar="3" style="top: 10%; left: 25%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 10%; left: 25%; transform: translate(-50%, 20px);">FL-雷达3</div>
                    
                    <div class="sensor front" data-radar="2" style="top: 10%; left: 40%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 10%; left: 40%; transform: translate(-50%, 20px);">FML-雷达2</div>
                    
                    <div class="sensor front" data-radar="1" style="top: 10%; left: 60%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 10%; left: 60%; transform: translate(-50%, 20px);">FMR-雷达1</div>
                    
                    <div class="sensor front" data-radar="0" style="top: 10%; left: 75%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 10%; left: 75%; transform: translate(-50%, 20px);">FR-雷达0</div>
                    
                    <!-- 后向传感器（左→右: 8-9-10-11） -->
                    <div class="sensor rear" data-radar="8" style="top: 90%; left: 25%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 90%; left: 25%; transform: translate(-50%, -30px);">RL-雷达8</div>
                    
                    <div class="sensor rear" data-radar="9" style="top: 90%; left: 40%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 90%; left: 40%; transform: translate(-50%, -30px);">RML-雷达9</div>
                    
                    <div class="sensor rear" data-radar="10" style="top: 90%; left: 60%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 90%; left: 60%; transform: translate(-50%, -30px);">RMR-雷达10</div>
                    
                    <div class="sensor rear" data-radar="11" style="top: 90%; left: 75%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 90%; left: 75%; transform: translate(-50%, -30px);">RR-雷达11</div>
                    
                    <!-- 左侧传感器（前→后: 4-5-6-7） -->
                    <div class="sensor side" data-radar="4" style="top: 20%; left: 10%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 25%; left: 10%; transform: translate(-40px, -50%);">FSL-雷达4</div>
                    
                    <div class="sensor side" data-radar="5" style="top: 40%; left: 10%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 45%; left: 10%; transform: translate(-40px, -50%);">FSLM-雷达5</div>
                    
                    <div class="sensor side" data-radar="6" style="top: 60%; left: 10%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 65%; left: 10%; transform: translate(-40px, -50%);">RSLM-雷达6</div>
                    
                    <div class="sensor side" data-radar="7" style="top: 80%; left: 10%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 85%; left: 10%; transform: translate(-40px, -50%);">RSL-雷达7</div>
                    
                    <!-- 右侧传感器（前→后: 15-14-13-12） -->
                    <div class="sensor side" data-radar="15" style="top: 20%; left: 90%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 20%; left: 90%; transform: translate(40px, -50%);">FSR-雷达15</div>
                    
                    <div class="sensor side" data-radar="14" style="top: 40%; left: 90%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 40%; left: 90%; transform: translate(40px, -50%);">FSRM-雷达14</div>
                    
                    <div class="sensor side" data-radar="13" style="top: 60%; left: 90%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 60%; left: 90%; transform: translate(40px, -50%);">RSRM-雷达13</div>
                    
                    <div class="sensor side" data-radar="12" style="top: 80%; left: 90%;">
                        <span>●</span>
                    </div>
                    <div class="sensor-label" style="top: 80%; left: 90%; transform: translate(40px, -50%);">RSR-雷达12</div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #f44336;"></div>
                        <span>Front Sensors</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #4CAF50;"></div>
                        <span>Rear Sensors</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #333;"></div>
                        <span>Side Sensors</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 辅助函数：将十六进制字符串转换为十进制数
        function hexToDecimal(hexStr) {
            // 处理可能的0x前缀
            if (hexStr.startsWith('0x')) {
                return parseInt(hexStr, 16);
            }
            return parseInt(hexStr, 16);
        }
        
        // 辅助函数：将十进制数转换为8位十六进制字符串（带0x前缀）
        function decimalToHex(decimal) {
            // 处理无符号32位整数范围
            const unsigned = decimal >>> 0;
            // 转换为十六进制，确保8位，大写字母
            return '0x' + unsigned.toString(16).padStart(8, '0').toUpperCase();
        }
        
        function updateSensorValues(radarValues) {
            // 清除之前的数值显示
            document.querySelectorAll('.sensor-value').forEach(el => el.remove());
            
            // 更新每个传感器的数值
            document.querySelectorAll('.sensor').forEach(sensor => {
                const radarId = sensor.getAttribute('data-radar');
                if (radarId !== null && radarValues[radarId] !== undefined) {
                    // 创建数值显示元素
                    let valueElement = document.createElement('div');
                    valueElement.className = 'sensor-value';
                    valueElement.style.position = 'absolute';
                    valueElement.style.fontSize = '11px';
                    valueElement.style.fontWeight = 'bold';
                    valueElement.style.color = '#333';
                    
                    // 计算十进制值
                    const decimalValue = hexToDecimal(radarValues[radarId]);
                    
                    // 根据传感器位置调整数值显示位置，避免与标签重叠
                    const position = sensor.style.left;
                    const topPos = sensor.style.top;
                    
                    if (position === '10%') { // 左侧传感器
                        valueElement.style.transform = 'translate(-110%, 30px)';
                    } else if (position === '90%') { // 右侧传感器
                        valueElement.style.transform = 'translate(10%, 30px)';
                    } else if (topPos === '10%') { // 前侧传感器
                        valueElement.style.transform = 'translate(-50%, 40px)';
                    } else { // 后侧传感器
                        valueElement.style.transform = 'translate(-50%, -60px)';
                    }
                    
                    // 显示十六进制和十进制值（单行显示）
                    valueElement.textContent = `0x${radarValues[radarId]} = ${decimalValue}`;
                    sensor.parentNode.appendChild(valueElement);
                    
                    // 将数值元素定位在传感器标签旁边
                    valueElement.style.top = sensor.style.top;
                    valueElement.style.left = sensor.style.left;
                }
            });
        }
        
        function extractRadarValues() {
            // 显示加载动画，隐藏错误信息
            const loading = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            loading.style.display = 'block';
            errorDiv.textContent = '';
            
            // 使用setTimeout模拟处理时间
            setTimeout(() => {
                const input = document.getElementById('radarInput').value.trim();
                const resultDiv = document.getElementById('result');
                const radarGroupsDiv = document.getElementById('radarGroups');
                const conversionInfoDiv = document.getElementById('conversionInfo');
                
                // 清空之前的结果
                radarGroupsDiv.innerHTML = '';
                conversionInfoDiv.innerHTML = '';
                resultDiv.style.display = 'none';
                
                // 分割输入字符串
                const parts = input.split(/\s+/);
                
                // 验证输入数量
                if (parts.length !== 4) {
                    errorDiv.textContent = '请输入4个32位数值，用空格分隔';
                    loading.style.display = 'none';
                    return;
                }
                
                // 检查输入类型：全为十六进制或全为十进制
                let isHexInput = false;
                let isDecimalInput = false;
                
                // 检查第一个值确定输入类型
                if (parts[0].startsWith('0x')) {
                    isHexInput = true;
                } else if (/^\d+$/.test(parts[0])) {
                    isDecimalInput = true;
                } else {
                    errorDiv.textContent = '输入格式错误：第一个值必须是0x开头的十六进制或纯数字的十进制';
                    loading.style.display = 'none';
                    return;
                }
                
                // 验证所有值是否与第一个值类型一致
                for (let i = 0; i < 4; i++) {
                    if (isHexInput && !parts[i].startsWith('0x') && !/^[0-9a-fA-F]{8}$/.test(parts[i])) {
                        errorDiv.textContent = `第${i+1}个值格式错误：十六进制值必须以0x开头或为8位十六进制数字`;
                        loading.style.display = 'none';
                        return;
                    }
                    if (isDecimalInput && !/^\d+$/.test(parts[i])) {
                        errorDiv.textContent = `第${i+1}个值格式错误：十进制值必须是纯数字`;
                        loading.style.display = 'none';
                        return;
                    }
                }
                
                const radarValues = [];
                let isValid = true;
                const hexParts = []; // 存储转换后的十六进制值
                const decimalInputs = []; // 记录哪些输入是十进制的
                
                for (let i = 0; i < 4; i++) {
                    let part = parts[i];
                    let hexPart;
                    let isDecimal = false;
                    
                    // 处理十六进制值
                    if (isHexInput) {
                        // 检查是否为8位十六进制（带或不带0x前缀）
                        if (/^0x[0-9a-fA-F]{8}$/.test(part)) {
                            hexPart = part;
                        } else if (/^[0-9a-fA-F]{8}$/.test(part)) {
                            hexPart = '0x' + part;
                        } else {
                            errorDiv.textContent = `第${i+1}个值"${part}"不是有效的8位十六进制数`;
                            isValid = false;
                            break;
                        }
                    } 
                    // 处理十进制值
                    else if (isDecimalInput) {
                        const decimalValue = parseInt(part, 10);
                        // 检查是否在32位无符号整数范围内
                        if (decimalValue < 0 || decimalValue > 4294967295) {
                            errorDiv.textContent = `第${i+1}个值"${part}"超出32位无符号整数范围（0-4294967295）`;
                            isValid = false;
                            break;
                        }
                        // 转换为8位十六进制
                        hexPart = decimalToHex(decimalValue);
                        isDecimal = true;
                        decimalInputs.push({index: i, decimal: part, hex: hexPart});
                    }
                    
                    hexParts.push(hexPart);
                    
                    // 提取每个字节（2位十六进制）- 小端序处理
                    const hexStr = hexPart.substring(2); // 去掉0x前缀
                    // 反向提取字节：从最后两个字符开始
                    for (let j = 3; j >= 0; j--) {
                        const start = j * 2;
                        const value = hexStr.substring(start, start + 2);
                        radarValues.push(value.toUpperCase()); // 统一转为大写
                    }
                }
                
                // 隐藏加载动画
                loading.style.display = 'none';
                
                if (!isValid) return;
                
                // 如果有十进制输入，显示转换信息
                if (decimalInputs.length > 0) {
                    const conversionTitle = document.createElement('div');
                    conversionTitle.style.fontWeight = 'bold';
                    conversionTitle.style.marginBottom = '5px';
                    conversionTitle.textContent = '十进制到十六进制转换：';
                    conversionInfoDiv.appendChild(conversionTitle);
                    
                    decimalInputs.forEach(item => {
                        const conversionItem = document.createElement('div');
                        conversionItem.className = 'decimal-to-hex';
                        conversionItem.textContent = `输入值 ${item.index + 1}: ${item.decimal} → ${item.hex}`;
                        conversionInfoDiv.appendChild(conversionItem);
                    });
                }
                
                // 更新传感器布局上的数值
                updateSensorValues(radarValues);
                
                // 显示结果
                for (let group = 0; group < 4; group++) {
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'radar-group';
                    
                    const groupTitle = document.createElement('h4');
                    groupTitle.textContent = `雷达组 ${group*4}-${group*4+3} (对应输入的第${group+1}个值: ${parts[group]} → ${hexParts[group]})`;
                    groupDiv.appendChild(groupTitle);
                    
                    const valuesDiv = document.createElement('div');
                    valuesDiv.className = 'radar-values';
                    
                    for (let i = 0; i < 4; i++) {
                        const index = group * 4 + i;
                        const hexValue = radarValues[index];
                        const decimalValue = hexToDecimal(hexValue); // 计算十进制值
                        
                        const valueDiv = document.createElement('div');
                        valueDiv.className = 'radar-value';
                        // 显示十六进制和十进制值（单行显示）
                        valueDiv.innerHTML = `<strong>雷达${index}:</strong> 0x${hexValue} = ${decimalValue}`;
                        valuesDiv.appendChild(valueDiv);
                    }
                    
                    groupDiv.appendChild(valuesDiv);
                    radarGroupsDiv.appendChild(groupDiv);
                }
                
                resultDiv.style.display = 'block';
            }, 500); // 500ms延迟，模拟处理时间
        }
        
        // 初始加载时自动解析示例数据
        window.onload = extractRadarValues;
    </script>
</body>
</html>
