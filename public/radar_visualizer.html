<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›·è¾¾è·ç¦»ç”Ÿæˆå™¨</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .main-content {
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #4CAF50;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .distance-input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .distance-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .radar-visualization {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .car-container {
            width: 600px;
            height: 500px;
            margin: 0 auto;
            position: relative;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            border: 2px solid #ddd;
            overflow: hidden;
        }

        .car-body {
            position: absolute;
            width: 120px;
            height: 200px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            border: 2px solid #5a6fd8;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .car-windshield {
            position: absolute;
            width: 80px;
            height: 40px;
            left: 50%;
            top: 15px;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.4);
            border-radius: 8px 8px 3px 3px;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .car-rear-window {
            position: absolute;
            width: 80px;
            height: 40px;
            left: 50%;
            bottom: 15px;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.4);
            border-radius: 3px 3px 8px 8px;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .car-wheel {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #333;
            border-radius: 50%;
            border: 2px solid #666;
        }

        .car-wheel.front-left {
            left: -8px;
            top: 40px;
        }

        .car-wheel.front-right {
            right: -8px;
            top: 40px;
        }

        .car-wheel.rear-left {
            left: -8px;
            bottom: 40px;
        }

        .car-wheel.rear-right {
            right: -8px;
            bottom: 40px;
        }

        .radar-sensor {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            border: 2px solid #2E7D32;
            transform: translate(-50%, -50%);
            transition: all 0.3s;
            cursor: pointer;
            z-index: 10;
        }

        .radar-sensor:hover {
            width: 12px;
            height: 12px;
            background: #66BB6A;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.8);
        }

        .radar-sensor.active {
            background: #FF5722;
            border-color: #D84315;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.7);
            }

            70% {
                box-shadow: 0 0 0 8px rgba(255, 87, 34, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(255, 87, 34, 0);
            }
        }

        .radar-wave {
            position: absolute;
            border-radius: 50%;
            border: 2px solid rgba(102, 187, 106, 0.6);
            transform: translate(-50%, -50%);
            pointer-events: none;
            animation: wave-expand 2s infinite;
        }

        @keyframes wave-expand {
            0% {
                width: 20px;
                height: 20px;
                opacity: 1;
            }

            100% {
                width: 120px;
                height: 120px;
                opacity: 0;
            }
        }

        .radar-beam {
            position: absolute;
            transform-origin: center;
            transition: all 0.3s;
            pointer-events: none;
            z-index: 5;
        }

        .radar-fan {
            position: absolute;
            transform-origin: center bottom;
            pointer-events: none;
            z-index: 3;
        }

        .sensor-label {
            position: absolute;
            font-size: 9px;
            font-weight: bold;
            color: #1976D2;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 2px 4px;
            border-radius: 3px;
            pointer-events: none;
            border: 1px solid #E3F2FD;
            z-index: 15;
        }

        .direction-label {
            position: absolute;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            padding: 8px 12px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 20;
        }

        .front-label {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .rear-label {
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .zone-outline {
            position: absolute;
            border: 2px dashed rgba(76, 175, 80, 0.5);
            border-radius: 8px;
            pointer-events: none;
            z-index: 1;
        }

        .front-zone {
            top: 50px;
            left: 50%;
            width: 280px;
            height: 120px;
            transform: translateX(-50%);
        }

        .rear-zone {
            bottom: 50px;
            left: 50%;
            width: 280px;
            height: 120px;
            transform: translateX(-50%);
        }

        .results-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .command-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
            margin-bottom: 15px;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .history {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
        }

        .history-item {
            background: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .history-item:last-child {
            margin-bottom: 0;
        }

        .timestamp {
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .distances-display {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .command-display {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #34495e;
            word-break: break-all;
        }

        @media (max-width: 768px) {
            .car-container {
                width: 480px;
                height: 400px;
                transform: scale(0.75);
            }

            .input-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .controls {
                justify-content: center;
            }

            .direction-label {
                font-size: 12px;
                padding: 6px 10px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <button class="btn btn-secondary" onclick="window.location.href='/'" style="position: absolute; top: 20px; left: 20px;">ğŸ  è¿”å›ä¸»é¡µ</button>
            <h1>ğŸ¯ é›·è¾¾è·ç¦»ç”Ÿæˆå™¨</h1>
            <p>è¾“å…¥16ä¸ªé›·è¾¾è·ç¦»å€¼ï¼Œç”Ÿæˆsignal_testerå‘½ä»¤</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h3>ğŸ“Š é›·è¾¾è·ç¦»è¾“å…¥ (0-15æ–¹å‘)</h3>
                <div class="input-grid" id="inputGrid">
                    <!-- è¾“å…¥æ¡†å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="generateCommand()">ğŸš€ ç”Ÿæˆå‘½ä»¤</button>
                    <button class="btn btn-secondary" onclick="fillRandom()">ğŸ² éšæœºå¡«å……</button>
                    <button class="btn btn-danger" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
                    <input type="text" id="bulkInput" placeholder="æ‰¹é‡è¾“å…¥ï¼šç”¨ç©ºæ ¼åˆ†éš”16ä¸ªæ•°å­—"
                        style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <button class="btn btn-secondary" onclick="parseBulkInput()">ğŸ“ æ‰¹é‡è¾“å…¥</button>
                </div>

                <!-- æ–°å¢ï¼šå…¨éƒ¨å¡«å……åŠŸèƒ½ -->
                <div class="controls" style="margin-top: 15px;">
                    <input type="number" id="fillValue" placeholder="è¯·è¾“å…¥è¦å¡«å……çš„æ•°å€¼" 
                           min="0" max="255" style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <button class="btn btn-primary" onclick="fillAll()">âœ… å…¨éƒ¨å¡«å……</button>
                </div>
            </div>

            <div class="results-section">
                <h3>ğŸ’» ç”Ÿæˆçš„å‘½ä»¤</h3>
                <div class="command-output" id="commandOutput">
                    <button class="copy-btn" onclick="copyCommand()">å¤åˆ¶</button>
                    <div id="commandText">è¯·è¾“å…¥é›·è¾¾è·ç¦»å¹¶ç‚¹å‡»"ç”Ÿæˆå‘½ä»¤"</div>
                </div>
            </div>

            <div class="radar-visualization">
                <h3>ğŸš— æ±½è½¦é›·è¾¾å¯è§†åŒ–</h3>
                <div class="car-container" id="carContainer">
                    <!-- æ–¹å‘æ ‡ç­¾ -->
                    <div class="direction-label front-label">Front</div>
                    <div class="direction-label rear-label">Rear</div>

                    <!-- æ£€æµ‹åŒºåŸŸè½®å»“ -->
                    <div class="zone-outline front-zone"></div>
                    <div class="zone-outline rear-zone"></div>

                    <div class="car-body">
                        <div class="car-windshield"></div>
                        <div class="car-rear-window"></div>
                        <div class="car-wheel front-left"></div>
                        <div class="car-wheel front-right"></div>
                        <div class="car-wheel rear-left"></div>
                        <div class="car-wheel rear-right"></div>
                    </div>
                    <!-- é›·è¾¾ä¼ æ„Ÿå™¨å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
                <div style="margin-top: 15px; font-size: 12px; color: #666;">
                    <p>å‰ä¾§(å·¦â†’å³): 3-2-1-0 | åä¾§(å·¦â†’å³): 8-9-10-11</p>
                    <p>å·¦ä¾§(å‰â†’å): 4-5-6-7 | å³ä¾§(å‰â†’å): 15-14-13-12</p>
                </div>
            </div>

            <div class="results-section">
                <h3>ğŸ“‹ å†å²è®°å½•</h3>
                <div class="history" id="history">
                    <p style="text-align: center; color: #666;">æš‚æ— å†å²è®°å½•</p>
                </div>
                <button class="btn btn-danger" onclick="clearHistory()" style="margin-top: 15px;">æ¸…ç©ºå†å²</button>
            </div>
        </div>
    </div>

    <script>
        let history = [];

        // åˆå§‹åŒ–è¾“å…¥æ¡†
        function initializeInputs() {
            const inputGrid = document.getElementById('inputGrid');
            for (let i = 0; i < 16; i++) {
                // åˆ›å»ºåŒ…è£…å®¹å™¨
                const inputWrapper = document.createElement('div');
                inputWrapper.style.display = 'flex';
                inputWrapper.style.flexDirection = 'column';
                inputWrapper.style.alignItems = 'center';
                inputWrapper.style.gap = '5px';

                // åˆ›å»ºç¼–å·æ ‡ç­¾
                const numberLabel = document.createElement('label');
                numberLabel.textContent = i;
                numberLabel.style.fontSize = '12px';
                numberLabel.style.fontWeight = 'bold';
                numberLabel.style.color = '#4CAF50';
                numberLabel.style.marginBottom = '3px';

                // åˆ›å»ºè¾“å…¥æ¡†
                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'distance-input';
                input.placeholder = `æ–¹å‘${i}`;
                input.min = '0';
                input.max = '255';
                input.id = `distance${i}`;
                input.addEventListener('input', updateVisualization);

                // å°†æ ‡ç­¾å’Œè¾“å…¥æ¡†æ·»åŠ åˆ°åŒ…è£…å®¹å™¨
                inputWrapper.appendChild(numberLabel);
                inputWrapper.appendChild(input);

                // å°†åŒ…è£…å®¹å™¨æ·»åŠ åˆ°ç½‘æ ¼
                inputGrid.appendChild(inputWrapper);
            }
        }

        // è½¦è¾†ä¸­å¿ƒå’Œè½¦èº«å°ºå¯¸é…ç½®
        const carCenter = { x: 300, y: 250 };
        const carBodyRadius = 80;

        // é›·è¾¾ä¼ æ„Ÿå™¨ä½ç½®é…ç½® - ä½äºè½¦èº«å¤–ä¾§è¾¹ç¼˜
        const sensorPositions = {
            // å‰ä¾§é›·è¾¾ (å·¦â†’å³): 3-2-1-0 - ä½äºè½¦èº«å‰ç«¯å¤–ä¾§
            0: { angle: 30, label: 'FR', name: 'Front Right' },        // å‰å³
            1: { angle: 10, label: 'FMR', name: 'Front Middle Right' }, // å‰ä¸­å³
            2: { angle: -10, label: 'FML', name: 'Front Middle Left' },  // å‰ä¸­å·¦
            3: { angle: -30, label: 'FL', name: 'Front Left' },         // å‰å·¦

            // å·¦ä¾§é›·è¾¾ (å‰â†’å): 4-5-6-7 - ä½äºè½¦èº«å·¦ä¾§å¤–ä¾§
            4: { angle: -60, label: 'FSL', name: 'Front Side Left' },    // å·¦å‰
            5: { angle: -80, label: 'FSLM', name: 'Front Side Left Middle' }, // å·¦ä¸­å‰
            6: { angle: -100, label: 'RSLM', name: 'Rear Side Left Middle' },  // å·¦ä¸­å
            7: { angle: -120, label: 'RSL', name: 'Rear Side Left' },     // å·¦å

            // åä¾§é›·è¾¾ (å·¦â†’å³): 8-9-10-11 - ä½äºè½¦èº«åç«¯å¤–ä¾§
            8: { angle: 210, label: 'RL', name: 'Rear Left' },          // åå·¦
            9: { angle: 190, label: 'RML', name: 'Rear Middle Left' },   // åä¸­å·¦
            10: { angle: 170, label: 'RMR', name: 'Rear Middle Right' }, // åä¸­å³
            11: { angle: 150, label: 'RR', name: 'Rear Right' },        // åå³

            // å³ä¾§é›·è¾¾ (å‰â†’å): 15-14-13-12 - ä½äºè½¦èº«å³ä¾§å¤–ä¾§
            12: { angle: 120, label: 'RSR', name: 'Rear Side Right' },   // å³å
            13: { angle: 100, label: 'RSRM', name: 'Rear Side Right Middle' }, // å³ä¸­å
            14: { angle: 80, label: 'FSRM', name: 'Front Side Right Middle' }, // å³ä¸­å‰
            15: { angle: 60, label: 'FSR', name: 'Front Side Right' }   // å³å‰
        };

        // æ ¹æ®è§’åº¦è®¡ç®—å®é™…ä½ç½®
        function getSensorPosition(sensorId) {
            const config = sensorPositions[sensorId];
            const angleRad = (config.angle - 90) * Math.PI / 180; // è°ƒæ•´è§’åº¦ï¼Œä½¿0åº¦æŒ‡å‘æ­£ä¸Šæ–¹
            return {
                x: carCenter.x + carBodyRadius * Math.cos(angleRad),
                y: carCenter.y + carBodyRadius * Math.sin(angleRad),
                label: config.label,
                name: config.name
            };
        }

        // åˆå§‹åŒ–æ±½è½¦é›·è¾¾å¯è§†åŒ–
        function initializeRadar() {
            const carContainer = document.getElementById('carContainer');

            // åˆ›å»ºé›·è¾¾ä¼ æ„Ÿå™¨
            for (let i = 0; i < 16; i++) {
                const sensorPos = getSensorPosition(i);

                const sensor = document.createElement('div');
                sensor.className = 'radar-sensor';
                sensor.id = `sensor${i}`;
                sensor.style.left = sensorPos.x + 'px';
                sensor.style.top = sensorPos.y + 'px';
                sensor.title = `${sensorPos.name} (${i}): ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…`;

                // æ·»åŠ ä¼ æ„Ÿå™¨æ ‡ç­¾ï¼Œä½ç½®ç¨å¾®åç§»ä»¥é¿å…é‡å 
                const label = document.createElement('div');
                label.className = 'sensor-label';
                label.textContent = sensorPos.label;

                // æ ¹æ®ä¼ æ„Ÿå™¨è§’åº¦è°ƒæ•´æ ‡ç­¾ä½ç½®
                const config = sensorPositions[i];
                const labelOffsetDistance = 20;
                const labelAngleRad = (config.angle - 90) * Math.PI / 180;
                const labelX = sensorPos.x + labelOffsetDistance * Math.cos(labelAngleRad);
                const labelY = sensorPos.y + labelOffsetDistance * Math.sin(labelAngleRad);

                label.style.left = labelX + 'px';
                label.style.top = labelY + 'px';

                carContainer.appendChild(sensor);
                carContainer.appendChild(label);
            }
        }

        // æ›´æ–°å¯è§†åŒ–
        function updateVisualization() {
            const carContainer = document.getElementById('carContainer');

            // æ¸…é™¤ç°æœ‰çš„é›·è¾¾æ³¢æŸå’Œæ³¢çº¹
            const existingEffects = carContainer.querySelectorAll('.radar-beam, .radar-wave, .radar-fan');
            existingEffects.forEach(effect => effect.remove());

            // æ›´æ–°æ¯ä¸ªä¼ æ„Ÿå™¨çŠ¶æ€
            for (let i = 0; i < 16; i++) {
                const input = document.getElementById(`distance${i}`);
                const sensor = document.getElementById(`sensor${i}`);
                const distance = parseInt(input.value) || 0;

                if (distance > 0) {
                    // æ¿€æ´»ä¼ æ„Ÿå™¨
                    sensor.classList.add('active');
                    const sensorPos = getSensorPosition(i);
                    sensor.title = `${sensorPos.name} (${i}): ${distance}cm`;

                    // åˆ›å»ºé›·è¾¾æ•ˆæœ
                    createRadarEffects(i, distance);
                } else {
                    // å–æ¶ˆæ¿€æ´»ä¼ æ„Ÿå™¨
                    sensor.classList.remove('active');
                    const sensorPos = getSensorPosition(i);
                    sensor.title = `${sensorPos.name} (${i}): æœªæ¿€æ´»`;
                }
            }
        }

        // åˆ›å»ºé›·è¾¾æ•ˆæœ (æ‰‡å½¢æ³¢æŸ + æ³¢çº¹)
        function createRadarEffects(sensorId, distance) {
            const carContainer = document.getElementById('carContainer');
            const sensorPos = sensorPositions[sensorId];

            // åˆ›å»ºæ‰‡å½¢é›·è¾¾æ³¢æŸ
            createRadarFan(sensorId, distance);

            // åˆ›å»ºé›·è¾¾æ³¢çº¹æ•ˆæœ
            createRadarWave(sensorId);
        }

        // åˆ›å»ºæ‰‡å½¢é›·è¾¾æ³¢æŸ - ä»è½¦èº«å¤–ä¾§å¼€å§‹å‘å¤–æ‰©æ•£
        function createRadarFan(sensorId, distance) {
            const carContainer = document.getElementById('carContainer');
            const sensorPos = getSensorPosition(sensorId);
            const config = sensorPositions[sensorId];

            // ä½¿ç”¨ä¼ æ„Ÿå™¨çš„é…ç½®è§’åº¦
            const angle = config.angle - 90; // è°ƒæ•´è§’åº¦ï¼Œä½¿0åº¦æŒ‡å‘æ­£ä¸Šæ–¹

            // ä¼ æ„Ÿå™¨ä½ç½®å°±æ˜¯è½¦èº«è¾¹ç¼˜èµ·ç‚¹
            const edgeStartX = sensorPos.x;
            const edgeStartY = sensorPos.y;

            // è®¡ç®—æ‰‡å½¢å‚æ•°
            const fanRadius = Math.min(distance * 1.8, 150);
            const fanAngle = 40; // æ‰‡å½¢è§’åº¦

            // åˆ›å»ºä»è½¦èº«å¤–ä¾§å‘å¤–æ‰©æ•£çš„æ‰‡å½¢æ³¢æŸ
            for (let i = 0; i < 3; i++) {
                const fan = document.createElement('div');
                fan.className = 'radar-fan';

                const opacity = 0.5 - (i * 0.12);
                const radius = fanRadius - (i * 20);

                fan.style.width = radius * 2 + 'px';
                fan.style.height = radius * 2 + 'px';
                fan.style.left = edgeStartX + 'px';
                fan.style.top = edgeStartY + 'px';

                // åˆ›å»ºæ‰‡å½¢è’™ç‰ˆ - åŸç‚¹åœ¨è½¦èº«å¤–ä¾§
                const startAngle = angle - fanAngle / 2;
                const endAngle = angle + fanAngle / 2;

                // æ‰‡å½¢åŸç‚¹åœ¨å…ƒç´ ä¸­å¿ƒï¼ˆå¯¹åº”è½¦èº«å¤–ä¾§ä½ç½®ï¼‰
                const originX = 50;
                const originY = 50;

                // è®¡ç®—æ‰‡å½¢å¼§çº¿ä¸Šçš„å¤šä¸ªç‚¹ï¼Œåˆ›å»ºå¹³æ»‘çš„æ‰‡å½¢
                const points = [`${originX}% ${originY}%`]; // èµ·å§‹ç‚¹ï¼ˆåŸç‚¹ï¼‰

                // åˆ›å»ºæ‰‡å½¢å¼§çº¿çš„å¤šä¸ªç‚¹
                const numPoints = 8; // å¢åŠ ç‚¹æ•°é‡ä½¿æ‰‡å½¢æ›´å¹³æ»‘
                for (let j = 0; j <= numPoints; j++) {
                    const currentAngle = startAngle + (endAngle - startAngle) * (j / numPoints);
                    const pointX = originX + 50 * Math.cos(currentAngle * Math.PI / 180);
                    const pointY = originY + 50 * Math.sin(currentAngle * Math.PI / 180);
                    points.push(`${pointX}% ${pointY}%`);
                }

                fan.style.background = `radial-gradient(circle at ${originX}% ${originY}%, 
                    rgba(255, 87, 34, ${opacity}) 0%, 
                    rgba(255, 152, 0, ${opacity * 0.8}) 25%, 
                    rgba(255, 193, 7, ${opacity * 0.6}) 50%,
                    rgba(76, 175, 80, ${opacity * 0.3}) 75%,
                    transparent 100%)`;

                // ä½¿ç”¨å¤šç‚¹polygonåˆ›å»ºå¹³æ»‘æ‰‡å½¢ï¼Œä»åŸç‚¹å¼€å§‹
                fan.style.clipPath = `polygon(${points.join(', ')})`;
                fan.style.transform = 'translate(-50%, -50%)';

                carContainer.appendChild(fan);
            }

            // æ·»åŠ ä»è½¦èº«å¤–ä¾§å‘å¤–çš„é›·è¾¾æ³¢æŸçº¿
            createRadarBeam(edgeStartX, edgeStartY, distance, angle);
        }

        // åˆ›å»ºä»è½¦èº«å¤–ä¾§å‘å¤–çš„é›·è¾¾æ³¢æŸçº¿
        function createRadarBeam(startX, startY, distance, angle) {
            const carContainer = document.getElementById('carContainer');

            // è®¡ç®—æ³¢æŸé•¿åº¦ï¼ˆä»è½¦èº«å¤–ä¾§å¼€å§‹ï¼‰
            const beamLength = Math.min(distance * 1.5, 120);
            const opacity = Math.min(distance / 150, 0.9);

            const beam = document.createElement('div');
            beam.className = 'radar-beam';
            beam.style.width = beamLength + 'px';
            beam.style.height = '4px';
            beam.style.left = startX + 'px';
            beam.style.top = startY + 'px';
            beam.style.background = `linear-gradient(to right, 
                rgba(255, 87, 34, ${opacity}) 0%, 
                rgba(255, 152, 0, ${opacity * 0.8}) 40%, 
                rgba(255, 193, 7, ${opacity * 0.6}) 70%,
                rgba(76, 175, 80, ${opacity * 0.4}) 90%,
                transparent 100%)`;
            beam.style.transform = `rotate(${angle}deg)`;
            beam.style.transformOrigin = '0 50%';
            beam.style.borderRadius = '2px';
            beam.style.boxShadow = `0 0 10px rgba(255, 87, 34, ${opacity * 0.6})`;

            carContainer.appendChild(beam);
        }

        // åˆ›å»ºé›·è¾¾æ³¢çº¹æ•ˆæœ - ä»è½¦èº«å¤–ä¾§æ‰©æ•£
        function createRadarWave(sensorId) {
            const carContainer = document.getElementById('carContainer');
            const sensorPos = getSensorPosition(sensorId);
            const config = sensorPositions[sensorId];

            // ä½¿ç”¨ä¼ æ„Ÿå™¨çš„é…ç½®è§’åº¦
            const angle = config.angle - 90; // è°ƒæ•´è§’åº¦ï¼Œä½¿0åº¦æŒ‡å‘æ­£ä¸Šæ–¹

            // ä¼ æ„Ÿå™¨ä½ç½®å°±æ˜¯è½¦èº«è¾¹ç¼˜èµ·ç‚¹
            const edgeStartX = sensorPos.x;
            const edgeStartY = sensorPos.y;

            // åˆ›å»º3ä¸ªä¸åŒå¤§å°çš„æ³¢çº¹ï¼Œä»è½¦èº«å¤–ä¾§å‘ä¼ æ„Ÿå™¨æ–¹å‘æ‰©æ•£
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const wave = document.createElement('div');
                    wave.className = 'radar-wave';
                    wave.style.left = edgeStartX + 'px';
                    wave.style.top = edgeStartY + 'px';
                    wave.style.animationDelay = (i * 0.4) + 's';

                    // ä¸ºæ³¢çº¹æ·»åŠ æ–¹å‘æ€§ï¼Œä½¿å…¶æœå‘ä¼ æ„Ÿå™¨æ–¹å‘æ‰©æ•£
                    wave.style.background = `radial-gradient(ellipse 120px 60px at center, 
                        transparent 0%, 
                        rgba(76, 175, 80, 0.6) 40%, 
                        rgba(76, 175, 80, 0.3) 70%, 
                        transparent 100%)`;
                    wave.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;

                    carContainer.appendChild(wave);

                    // 2ç§’åç§»é™¤æ³¢çº¹
                    setTimeout(() => {
                        if (wave.parentNode) {
                            wave.parentNode.removeChild(wave);
                        }
                    }, 2000);
                }, i * 400);
            }
        }

        // è·å–æ³¢æŸæ–¹å‘
        function getBeamDirection(sensorId) {
            if (sensorId >= 0 && sensorId <= 3) return 'front';
            if (sensorId >= 4 && sensorId <= 7) return 'left';
            if (sensorId >= 8 && sensorId <= 11) return 'rear';
            if (sensorId >= 12 && sensorId <= 15) return 'right';
            return 'front';
        }

        // ç”Ÿæˆå‘½ä»¤
        function generateCommand() {
            const distances = [];
            let hasValue = false;

            for (let i = 0; i < 16; i++) {
                const input = document.getElementById(`distance${i}`);
                const value = parseInt(input.value) || 0;
                distances.push(value);
                if (value > 0) hasValue = true;
            }

            if (!hasValue) {
                alert('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªè·ç¦»å€¼ï¼');
                return;
            }

            // æ¨¡æ‹ŸC++ç¨‹åºçš„é€»è¾‘
            // ä½¿ç”¨ >>> 0 å°†ç»“æœè½¬æ¢ä¸ºæ— ç¬¦å·32ä½æ•´æ•°ï¼Œé¿å…ç¬¦å·æ‰©å±•
            const data1 = ((distances[3] << 24) | (distances[2] << 16) | (distances[1] << 8) | distances[0]) >>> 0;
            const data2 = ((distances[7] << 24) | (distances[6] << 16) | (distances[5] << 8) | distances[4]) >>> 0;
            const data3 = ((distances[11] << 24) | (distances[10] << 16) | (distances[9] << 8) | distances[8]) >>> 0;
            const data4 = ((distances[15] << 24) | (distances[14] << 16) | (distances[13] << 8) | distances[12]) >>> 0;

            const command = `signal_tester 30003 ${data1} ${data2} ${data3} ${data4} 0 0 0 16 0 0 0 0`;

            // æ˜¾ç¤ºå‘½ä»¤
            document.getElementById('commandText').textContent = command;

            // æ·»åŠ åˆ°å†å²è®°å½•
            addToHistory(distances, command);

            // æ›´æ–°å¯è§†åŒ–
            updateVisualization();
        }

        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(distances, command) {
            const timestamp = new Date().toLocaleString('zh-CN');
            const historyItem = {
                timestamp,
                distances: distances.slice(),
                command
            };

            history.unshift(historyItem);
            if (history.length > 10) {
                history = history.slice(0, 10); // åªä¿ç•™æœ€è¿‘10æ¡è®°å½•
            }

            updateHistoryDisplay();
        }

        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function updateHistoryDisplay() {
            const historyDiv = document.getElementById('history');

            if (history.length === 0) {
                historyDiv.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— å†å²è®°å½•</p>';
                return;
            }

            historyDiv.innerHTML = history.map(item => `
                <div class="history-item">
                    <div class="timestamp">${item.timestamp}</div>
                    <div class="distances-display">è·ç¦»: [${item.distances.join(', ')}]</div>
                    <div class="command-display">${item.command}</div>
                </div>
            `).join('');
        }

        // éšæœºå¡«å……
        function fillRandom() {
            for (let i = 0; i < 16; i++) {
                const input = document.getElementById(`distance${i}`);
                input.value = Math.floor(Math.random() * 100) + 1;
            }
            updateVisualization();
        }

        // æ¸…ç©ºæ‰€æœ‰è¾“å…¥
        function clearAll() {
            for (let i = 0; i < 16; i++) {
                const input = document.getElementById(`distance${i}`);
                input.value = '';
            }
            updateVisualization();
        }

        // æ‰¹é‡è¾“å…¥è§£æ
        function parseBulkInput() {
            const bulkInput = document.getElementById('bulkInput');
            const values = bulkInput.value.trim().split(/\s+/);

            if (values.length !== 16) {
                alert('è¯·è¾“å…¥æ°å¥½16ä¸ªæ•°å­—ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼');
                return;
            }

            for (let i = 0; i < 16; i++) {
                const input = document.getElementById(`distance${i}`);
                const value = parseInt(values[i]);
                if (isNaN(value) || value < 0 || value > 255) {
                    alert(`ç¬¬${i + 1}ä¸ªæ•°å­—æ— æ•ˆï¼Œè¯·è¾“å…¥0-255ä¹‹é—´çš„æ•´æ•°ï¼`);
                    return;
                }
                input.value = value;
            }

            bulkInput.value = '';
            updateVisualization();
        }

        // å¤åˆ¶å‘½ä»¤
        function copyCommand() {
            const commandText = document.getElementById('commandText').textContent;
            if (commandText === 'è¯·è¾“å…¥é›·è¾¾è·ç¦»å¹¶ç‚¹å‡»"ç”Ÿæˆå‘½ä»¤"') {
                alert('è¯·å…ˆç”Ÿæˆå‘½ä»¤ï¼');
                return;
            }

            navigator.clipboard.writeText(commandText).then(() => {
                alert('å‘½ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
                const textArea = document.createElement('textarea');
                textArea.value = commandText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('å‘½ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        // æ¸…ç©ºå†å²è®°å½•
        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                history = [];
                updateHistoryDisplay();
            }
        }

        // å…¨éƒ¨å¡«å……
        function fillAll() {
            const fillValue = document.getElementById('fillValue').value;
            if (!fillValue || isNaN(fillValue)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—ï¼');
                return;
            }
            
            const value = parseInt(fillValue);
            if (value < 0 || value > 255) {
                alert('è¯·è¾“å…¥0-255ä¹‹é—´çš„æ•´æ•°ï¼');
                return;
            }

            // å¡«å……æ‰€æœ‰16ä¸ªè¾“å…¥æ¡†
            for (let i = 0; i < 16; i++) {
                const input = document.getElementById(`distance${i}`);
                input.value = value;
            }
            
            // æ›´æ–°å¯è§†åŒ–
            updateVisualization();
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function () {
            initializeInputs();
            initializeRadar();
            updateVisualization();
        });
    </script>
</body>

</html>